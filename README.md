# 🎫 מערכת ניהול תורים וובית

מערכת מלאה לניהול תורים בנק עם 3 מסכים עיקריים, רענון אוטומטי, ו-database מובנית.

## 🎯 תכונות

### ✅ המערכת כוללת:
- **מסך 1 - דשבורד**: תצוגת כל התורים עם מספר הלקוחות בכל תור
- **מסך 2 - הוספה**: הזנה של לקוח חדש לתור
- **מסך 3 - ניהול**: קידום לקוחות, סיום שירות, וניהול התור בזמן אמת
- **Database SQLite**: אחסון נתונים מצד השרת
- **רענון אוטומטי**: דשבורד מתרפרש כל 3 שניות, ניהול תור כל 2 שניות
- **עיצוב מודרני**: UI חזותי ונוח לשימוש

---

## 🚀 התקנה והפעלה

### 1. התקנת Python Packages

```bash
cd queue_system
pip install -r requirements.txt
```

### 2. הפעלת השרת

```bash
python app.py
```

השרת יופעל כברירת מחדל על: `http://localhost:5000`

---

## 📊 מבנה בסיס הנתונים

### טבלה 1: `queues` - סוגי התורים
```sql
CREATE TABLE queues (
    id INTEGER PRIMARY KEY,
    name TEXT,              -- שם התור (שירות לקוחות, פתיחת חשבון וכו')
    description TEXT,       -- תיאור התור
    counter TEXT,           -- מס' החלון/דלפק
    current_number INTEGER, -- מס' הלקוח הנוכחי בשירות
    created_at TIMESTAMP    -- זמן יצירת התור
)
```

### טבלה 2: `queue_entries` - רשימת הלקוחות בתור
```sql
CREATE TABLE queue_entries (
    id INTEGER PRIMARY KEY,
    queue_id INTEGER,       -- איזה תור
    customer_number INTEGER, -- מס' הלקוח
    status TEXT,            -- 'waiting' (בהמתנה), 'called' (בשירות), 'completed' (הושלם)
    created_at TIMESTAMP,   -- זמן הוספה לתור
    called_at TIMESTAMP,    -- זמן קריאה לשירות
    completed_at TIMESTAMP  -- זמן סיום שירות
)
```

---

## 🎛️ ערכות בקרה ו-API

### API קריאות (Endpoints):

**קבלת כל התורים:**
```
GET /api/queues
```
תגובה:
```json
[
    {
        "id": 1,
        "name": "שירות לקוחות",
        "counter": "חלון 1",
        "current_number": 15,
        "waiting_count": 3
    }
]
```

**הוספת לקוח לתור:**
```
POST /api/add-entry
Content-Type: application/json

{
    "queue_id": 1,
    "customer_number": 123
}
```

**קבלת פרטי תור:**
```
GET /api/queue/{queue_id}
```

**קריאה ללקוח הבא:**
```
POST /api/call-next/{queue_id}
```

**סיום שירות:**
```
POST /api/complete/{entry_id}
```

**הסרת לקוח מהתור:**
```
DELETE /api/remove/{entry_id}
```

---

## 🖥️ 3 המסכים

### מסך 1️⃣ - דשבורד (Dashboard)
**נתיב:** `/`

**תכונות:**
- תצוגת כל התורים בכרטיסים
- מראה את מס' הלקוח הנוכחי בכל תור
- מראה כמה לקוחות בהמתנה בכל תור
- שקול אדום/צהוב/ירוק לפי עומס
- **רענון אוטומטי כל 3 שניות**
- קישורים ישירים להוספה וניהול

### מסך 2️⃣ - הוספת לקוח (Add Customer)
**נתיב:** `/add-customer`

**תכונות:**
- בחירת תור מתוך dropdown
- הזנת מס' לקוח (זיהוי, תיק וכו')
- הצגת הודעת הצלחה/שגיאה
- רשימה של הוצאות אחרונות
- ניתן להוסיף לקוחות בעזרת כפתור

### מסך 3️⃣ - ניהול התור (Queue Management)
**נתיב:** `/queue-management`

**תכונות:**
- בחירת תור
- **תצוגה ענקית של הלקוח הנוכחי**
- רשימת כל הלקוחות בתור עם סטטוס:
  - 🟡 בהמתנה
  - 🔵 בשירות
  - 🟢 הושלם
- כפתורים:
  - 📢 קרא ללקוח הבא
  - ✅ סיים שירות
  - ⏭️ דלג על לקוח
- **רענון אוטומטי כל 2 שניות**
- סטטיסטיקות בזמן אמת

---

## 📝 דוגמה לשימוש

### שלב 1: הוספת לקוח חדש
1. כנסו לעמוד `/add-customer`
2. בחרו תור (לדוגמה: "שירות לקוחות")
3. הזנו מס' לקוח (לדוגמה: 123)
4. לחצו "הוסף לתור"

### שלב 2: קריאה ללקוח הבא
1. כנסו לעמוד `/queue-management`
2. בחרו את התור
3. לחצו "📢 קרא ללקוח הבא"
4. מס' הלקוח יוצג בגדול בחלק העליון

### שלב 3: סיום שירות
1. לחצו "✅ סיים שירות"
2. הלקוח יתעדכן ל-"הושלם"
3. הלקוח הבא בתור יוכל להיות נקרא

---

## 🎨 התאמה של סוגי התורים

כדי לשנות את סוגי התורים, ערכו את קובץ `config.json`:

```json
{
  "queues": [
    {
      "id": 1,
      "name": "שירות לקוחות",
      "description": "שירות כללי",
      "counter": "חלון 1"
    },
    {
      "id": 2,
      "name": "הלוואות",
      "description": "ייעוץ הלוואות",
      "counter": "חלון 2"
    }
  ]
}
```

**שימו לב:** בעלות הראשונה של `app.py`, התורים מה-JSON יוטבעו לתוך ה-SQLite Database.

---

## 📊 ייצוא דוח

ניתן להוריד דוח JSON של כל תור:
```
GET /api/report/{queue_id}
```

---

## 🔧 טיפולת בעיות

**שרת לא מתחבר?**
- וודאו שפורט 5000 לא תפוס
- נסו להריץ: `python app.py`

**HTML לא מופיע בעברית נכון?**
- וודאו שהקבצים HTML נשמרו בקידוד UTF-8

**Database לא עדכן?**
- מחקו את `queue_system.db` והריצו שוב את `app.py`

---

## 📦 קבצי המערכת

```
queue_system/
├── app.py                    # Backend Flask
├── config.json              # קונפיגורציה של התורים
├── requirements.txt         # דרישות Python
├── queue_system.db          # SQLite Database (נוצר אוטומטית)
└── templates/
    ├── dashboard.html       # מסך 1
    ├── add_customer.html    # מסך 2
    └── queue_management.html # מסך 3
```

---

## 🌐 הגדרת למציאות חיצוני

כדי להפוך את השרת לנגיש מ-מחוץ ל-localhost:

```python
# בקובץ app.py, החליפו:
if __name__ == '__main__':
    init_db()
    app.run(debug=True, port=5000, host='0.0.0.0')  # 0.0.0.0 = כל הרשתות
```

או שימוש ב-WSGI Server (Gunicorn):
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

---

## 📞 שאלות ותמיכה

במקרה של בעיות, בדקו:
1. שהפקדים Python מותקנים נכון
2. שפורט 5000 זמין
3. שקבצי ה-HTML נמצאים בתקיית `templates/`

בהצלחה! 🚀
